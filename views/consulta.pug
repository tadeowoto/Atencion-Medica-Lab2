extends layout 

block head 
    script(src="/js/consulta.js" defer)    

block content
     body(class="bg-primaryForeground min-h-screen h-screen w-full flex flex-col gap-12 font-sans")
        section(class="bg-primaryForeground min-h-screen h-screen w-full flex flex-col gap-12 font-sans")
            div(class="w-full h-12  flex items-center justify-end") 
                h1(class="mt-20 text-2xl text-thirdFont font-semibold mr-32") Consulta - #{nombre.nombre}
            section(class="w-full flex justify-evenly h-full")
                div(class="w-3/6 h-full bg-white rounded-lg shadow-md p-10 box-border flex flex-col gap-3")
                    div(class="w-full h-5 flex items-center")
                        svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus mr-2 h-6 w-6 text-primary")
                            path(d="M5 12h14")
                            path(d="M12 5v14")
                        h3(class="text-2xl font-semibold") Nueva Consulta

                    div(class="w-full h-full flex flex-col gap-5 overflow-y-auto")
                        form(class="flex flex-col gap-6  p-4 bg-white rounded-lg overflow-y-scroll" action="/consulta" method="POST" id="formularioConsulta")
                            div(class="w-full h-60")
                                label(for="evolucion" class="text-md text-secondaryColor font-semibold") Evolución
                                select(name="evoTemplate" id="selectEvolucion" class="h-10 w-full rounded-md border bg-background px-3 py-2 text-sm focus:ring-2 focus:ring-gray-300")
                                    option(value="", disabled=true, selected=true id="default") Selecciona una opción
                                    option(value="T1") Evaluación inicial
                                    option(value="T2") Control de seguimiento
                                    option(value="T3") Revisión postquirúrgica
                                    option(value="T4") Ajuste de tratamiento
                                    option(value="T5") Alta médica
                                textarea(class="h-24 w-full resize-none rounded-md border border-input bg-background px-3 py-2 text-sm focus:ring-2 focus:ring-gray-300 mt-1" name="evolucion" id="inputEvolucion" required)

                            div(class="w-full h-60 border-b-2 border-t-2 border-gray-300 pb-4 pt-4 box-border flex flex-col")
                                label(for="" class="text-md text-secondaryColor font-semibold mt-2") Diagnóstico/s
                                div(class="flex flex-col w-full max-h-32 space-y-2 overflow-y-auto" id="diagnosticoBox")
                                    div(class="flex gap-2")
                                        select(class="h-8 w-40 rounded-md border bg-background px-2 py-1 text-xs focus:ring-2 focus:ring-gray-300" name="estadosDiagnosticos[]")
                                            option(value="Preliminar") Preliminar  
                                            option(value="Confirmado") Confirmado  
                                        input(type="text" required class="w-full h-8 rounded-md border border-input bg-background px-3 text-sm focus:ring-2 focus:ring-gray-300" name="diagnosticos[]")
                                button(type="button" onClick="agregarInputDiag()" class="flex items-center justify-center text-sm font-medium border bg-gray-100 text-secondaryColor w-40 h-9 rounded-md focus:ring-2 focus:ring-gray-300") Añadir Diagnóstico

                            div(class="w-full h-60 border-b-2 border-t-2 border-gray-300 pb-4 pt-4 box-border flex flex-col")
                                label(for="" class="text-md text-secondaryColor font-semibold mt-2") Alergias
                                div(id="alergiaBox" class="flex flex-col space-y-4 overflow-y-scroll h-60")
                                    div(class="w-full flex flex-wrap gap-2")
                                        select(name="alergias[]" class="w-52 h-8 rounded-md border bg-background px-2 py-1 text-xs focus:ring-2 focus:ring-gray-300")
                                            option(value="nada", disabled=true, selected=true) Alergia
                                            each alergia in alergiasOpciones
                                                option(value=`#{alergia}`) #{alergia}
                                        select(name="importancia[]" class="h-8 rounded-md border bg-background px-2 py-1 text-xs focus:ring-2 focus:ring-gray-300")
                                            option(value="nada", disabled=true, selected=true) Importancia
                                            option(value="Leve") Leve
                                            option(value="Normal") Normal
                                            option(value="Alta") Alta
                                    div(class="w-full flex flex-wrap gap-2")
                                        label(for="desde" class="text-sm font-semibold") Desde    
                                        input(type="date" name="desdeAlergias[]" class="w-40 h-8 rounded-md border border-input bg-background px-3 text-sm focus:ring-2 focus:ring-gray-300")    
                                        label(for="hasta" class="text-sm font-semibold") Hasta    
                                        input(type="date" name="hastaAlergias[]" class="w-40 h-8 rounded-md border border-input bg-background px-3 text-sm focus:ring-2 focus:ring-gray-300")
                                button(type="button" onClick="agregarInputAlergia()" class="flex items-center justify-center text-sm font-medium border bg-gray-100 text-secondaryColor w-40 h-9 rounded-md focus:ring-2 focus:ring-gray-300 mt-1") Añadir Alergia

                            div(class="w-full h-60 border-b-2 border-t-2 border-gray-300 pb-4 pt-4 box-border flex flex-col")
                                div(id="habitoBox" class="flex flex-col space-y-4 overflow-y-scroll h-60")
                                    div(class="w-full flex flex-wrap gap-2 flex-col")
                                        h3(class="text-md text-secondaryColor font-semibold") Hábitos 
                                        label(for="habitos" class="text-sm font-semibold") Descripción    
                                        textarea(class="h-16 w-full resize-none rounded-md border border-input bg-background px-3 py-2 text-sm focus:ring-2 focus:ring-gray-300 mt-1" name="habitos[]")
                                    div(class="w-full flex flex-wrap gap-2")
                                        label(for="desde" class="text-sm font-semibold") Desde    
                                        input(type="date" name="desdeHabitos[]" class="w-40 h-8 rounded-md border border-input bg-background px-3 text-sm focus:ring-2 focus:ring-gray-300")    
                                        label(for="hasta" class="text-sm font-semibold") Hasta    
                                        input(type="date" name="hastaHabitos[]" class="w-40 h-8 rounded-md border border-input bg-background px-3 text-sm focus:ring-2 focus:ring-gray-300")
                                button(type="button" onClick="agregarInputHabitos()" class="flex items-center justify-center text-sm font-medium border bg-gray-100 text-secondaryColor w-40 h-9 rounded-md focus:ring-2 focus:ring-gray-300 mt-1") Añadir Hábito

                            div(class="w-full h-60 border-b-2 border-t-2 border-gray-300 pb-4 pt-4 box-border flex flex-col")
                                div(id="antecedenteBox" class="flex flex-col space-y-4 overflow-y-scroll h-60")
                                    div(class="w-full flex flex-wrap gap-2 flex-col")
                                        h3(class="text-md text-secondaryColor font-semibold") Antecedentes 
                                        label(for="antecedentes" class="text-sm font-semibold") Descripción    
                                        textarea(class="h-16 w-full resize-none rounded-md border border-input bg-background px-3 py-2 text-sm focus:ring-2 focus:ring-gray-300 mt-1" name="antecedentes[]")
                                    div(class="w-full flex flex-wrap gap-2")
                                        label(for="desde" class="text-sm font-semibold") Desde    
                                        input(type="date" name="desdeAntecedentes[]" class="w-40 h-8 rounded-md border border-input bg-background px-3 text-sm focus:ring-2 focus:ring-gray-300")    
                                        label(for="hasta" class="text-sm font-semibold") Hasta    
                                        input(type="date" name="hastaAntecedentes[]" class="w-40 h-8 rounded-md border border-input bg-background px-3 text-sm focus:ring-2 focus:ring-gray-300")
                                button(type="button" onClick="agregarInputAntecedente()" class="flex items-center justify-center text-sm font-medium border bg-gray-100 text-secondaryColor w-40 h-9 rounded-md focus:ring-2 focus:ring-gray-300 mt-1") Añadir Antecedente
                            
                            div(class="w-full h-60 border-b-2 border-t-2 border-gray-300 pb-4 pt-4 box-border flex flex-col")
                                div(id="medicamentoBox" class="flex flex-col space-y-4 overflow-y-scroll h-60")
                                    div(class="w-full flex flex-wrap gap-2 flex-col") 
                                        h3(class="text-md text-secondaryColor font-semibold") Medicamentos
                                        label(for="medicamentos" class="text-sm font-semibold") Descripción    
                                        textarea(class="h-16 w-full resize-none rounded-md border border-input bg-background px-3 py-2 text-sm focus:ring-2 focus:ring-gray-300 mt-1" name="medicamentos[]")
                                button(type="button" onClick="agregarInputMedicamento()" class="flex items-center justify-center text-sm font-medium border bg-gray-100 text-secondaryColor w-40 h-9 rounded-md focus:ring-2 focus:ring-gray-300 mt-1") Añadir Medicamento
                            
                            div(class="w-full h-60 border-b-2 border-gray-300 pb-4 box-border flex flex-col")
                                button(type="submit" form="formularioConsulta" class="flex items-center justify-center text-sm font-medium bg-secondaryColor text-white w-full h-9 rounded-md hover:bg-secondaryColor/50 focus:ring-2 focus:ring-gray-300") Cerrar Consulta


                div(class="w-1/4 h-2/3 bg-white rounded-lg shadow-md p-10 box-border flex flex-col ")
                    div(class=" max-h-full w-full flex flex-col items-center justify-center gap-12")
                        article(class="w-full h-24")
                            div(class="flex gap-1")
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-triangle-alert mr-2 h-5 w-5 text-yellow-500" data-id="12"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"></path><path d="M12 9v4"></path><path d="M12 17h.01"></path></svg>
                                p(class="text-md font-semibold") Alergias 
                            ul(class="w-full")
                                if (alergias)
                                    each alergia in alergias
                                        li(class="w-full h-7 bg-yellow-100 p-1 box-border text-center rounded-md text-sm mt-2 mb-2 text-secondaryFont") #{alergia.nombre} - Importancia: #{alergia.importancia}
                                else
                                    p(class="mt-2 ml-8 text-md text-secondaryFont") Este paciente no tiene alergias          
                        article(class="w-full h-24")
                            div(class="flex gap-1")
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-activity mr-2 h-5 w-5 text-blue-500" data-id="17"><path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"></path></svg>
                                p(class="text-md font-semibold") Antecedentes Patológicos 
                            ul(class="w-full")
                                if (antecedentes)
                                    each antecedente in antecedentes
                                        li(class="w-full h-7 bg-blue-100 p-1 box-border text-center rounded-md text-sm mt-2 mb-2 text-secondaryFont") #{antecedente.antecedente}
                                else
                                    p(class="mt-2 ml-8 text-md text-secondaryFont") Este paciente no tiene antecedentes
                        article(class="w-full h-24")
                            div(class="flex gap-1")
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cigarette mr-2 h-5 w-5 text-green-500" data-id="22"><path d="M18 12H2v4h16"></path><path d="M22 12v4"></path><path d="M7 12v4"></path><path d="M18 8c0-2.5-2-2.5-2-5"></path><path d="M22 8c0-2.5-2-2.5-2-5"></path></svg>
                                p(class="text-md font-semibold") Hábitos 
                            ul(class="")
                                if (habitos)
                                    each habito in habitos
                                        li(class="w-full h-7 bg-green-100 p-1 box-border text-center rounded-md text-sm mt-2 mb-2 text-secondaryFont") #{habito.habito}
                                else
                                    p(class="mt-2 ml-8 text-md text-secondaryFont") Este paciente no tiene hábitos  
                        article(class="w-full h-24 mb-10")
                            div(class="flex gap-1")
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pill mr-2 h-5 w-5 text-red-500" data-id="27"><path d="m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z"></path><path d="m8.5 8.5 7 7"></path></svg>
                                p(class="text-md font-semibold") Medicamentos en uso 
                            ul(class="")
                                if (medicamentos)
                                    each medicamento in medicamentos
                                        li(class="w-full h-7 bg-red-100 p-1 box-border text-center rounded-md text-sm mt-2 mb-2 text-secondaryFont") #{medicamento.medicamento}
                                else
                                    p(class="mt-2 ml-8 text-md text-secondaryFont") Este paciente no tiene medicamentos recetados
        
        section(class="bg-primaryForeground min-h-screen h-screen w-full flex flex-col gap-12 font-sans")
                div(class="w-3/6 h-full bg-white rounded-lg shadow-md p-10 box-border flex flex-col gap-3 overflow-y-auto")
                div(class="w-1/4 h-full bg-white rounded-lg shadow-md p-10 box-border flex flex-col ")